import * as log from '../log.js';
import requestSimple from '../requestSimple/index.js';
export default function requestTimestamp(server, data) {
    return new Promise((resolve, reject) => {
        const bin = Buffer.from(data);
        const options = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/timestamp-query',
                'Content-Length': `${bin.byteLength}`,
            },
            body: bin,
        };
        log.info(`[sign] Request timestamp server '${server}' (data length = ${data.byteLength}).`);
        requestSimple(server, options, (err, headers, body) => {
            var _a;
            if (err !== null && err !== undefined) {
                reject(err);
                return;
            }
            if (headers['content-type'] !== 'application/timestamp-reply') {
                reject(new Error(`Unexpected Content-Type for response: ${(_a = headers['content-type']) !== null && _a !== void 0 ? _a : ''}`));
                return;
            }
            log.debug(`[sign] Server responded with valid timestamp data (length = ${body.byteLength})`);
            resolve(body);
        });
    });
}
